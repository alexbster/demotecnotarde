# Stage 1: Compile and Build application
FROM node:12-alpine as build
WORKDIR /build
COPY package*.json /build/
RUN npm ci
COPY ./ /build/
RUN npm run build

# Stage 2: Runtime container
FROM node:12-alpine as runtime
WORKDIR /app
COPY package*.json /app/
RUN npm ci --production
COPY --from=build /build/dist /app/dist
RUN apk --no-cache add curl
EXPOSE 8080
ENTRYPOINT ["npm", "start"]